<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesian Mechanistic Interpretability: A New Framework</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts (Noto Sans for academic/clean look) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #FAFAF9; /* warm neutral stone-50 */
            color: #44403C; /* stone-700 */
        }

        /* Chart Container Styling - MANDATORY REQUIREMENT */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* max-w-xl equivalent */
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        /* Custom scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #a8a29e;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #78716c;
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        
        .interactive-btn {
            transition: all 0.2s ease;
        }
        .interactive-btn:hover {
            transform: translateY(-1px);
        }
        .interactive-btn:active {
            transform: translateY(1px);
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 antialiased selection:bg-stone-200 selection:text-stone-900">

    <!-- Chosen Palette: Warm Neutrals (Stone) with Professional Accents (Indigo/Teal) for academic rigor and clarity. -->
    <!-- Application Structure Plan: 
         1. Header: High-level overview of the research shift.
         2. Phase 1 (Uncertainty): Interactive visualization comparing "Point Estimate" (Old) vs. "Bayesian Posterior" (New).
            - Goal: Show why probabilistic thinking is better for circuit ID.
         3. Methodology Breakdown: A structural layout (Grid) defining the "Functional Hypothesis" approach.
         4. Phase 2 (Validation): Interactive simulation of "Posterior Predictive Checks".
            - Goal: Allow user to "test" a circuit hypothesis against noise to understand the validation framework.
         5. Synthesis: Summary of deliverables.
    -->
    <!-- Visualization & Content Choices:
         - Intro Chart: Bar chart toggling between single value (certainty) and distribution (uncertainty). Uses Chart.js.
         - Validation Chart: Scatter plot simulating correlation data. Uses Chart.js.
         - Interaction: Buttons to trigger state changes in charts and text.
         - Layout: Clean single-column container with card-based sections for readability.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- Navigation / Header -->
    <header class="w-full bg-white border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-3 h-3 bg-indigo-600 rounded-full"></div>
                <h1 class="text-lg font-bold tracking-tight text-stone-900">MechInterp <span class="font-light text-stone-500">| Bayesian Framework</span></h1>
            </div>
            <nav class="hidden md:flex space-x-8 text-sm font-medium text-stone-500">
                <a href="#phase1" class="hover:text-indigo-600 transition-colors">Phase 1: Uncertainty</a>
                <a href="#methodology" class="hover:text-indigo-600 transition-colors">Methodology</a>
                <a href="#phase2" class="hover:text-indigo-600 transition-colors">Phase 2: Validation</a>
            </nav>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Hero Section -->
        <section class="text-center space-y-6 max-w-3xl mx-auto">
            <h2 class="text-4xl sm:text-5xl font-bold text-stone-900 leading-tight">
                Quantifying Uncertainty in <br><span class="text-indigo-600">Circuit Identification</span>
            </h2>
            <p class="text-lg text-stone-600 leading-relaxed">
                Moving beyond point estimates. A research proposal to treat circuit discovery as <strong>Bayesian inference</strong> over functional hypotheses, delivering robust posterior distributions and rigorous validation frameworks.
            </p>
            <div class="flex justify-center gap-4 pt-4">
                <a href="#phase1" class="interactive-btn px-6 py-2.5 bg-stone-900 text-white rounded-lg text-sm font-medium shadow-md hover:bg-stone-800">Explore Framework</a>
                <a href="#phase2" class="interactive-btn px-6 py-2.5 bg-white border border-stone-300 text-stone-700 rounded-lg text-sm font-medium shadow-sm hover:bg-stone-50">Validation Methods</a>
            </div>
        </section>

        <!-- Phase 1: Uncertainty Quantification -->
        <section id="phase1" class="bg-white rounded-2xl p-8 card-shadow border border-stone-100">
            <div class="flex flex-col md:flex-row gap-8 items-start">
                <div class="md:w-1/2 space-y-4">
                    <div class="uppercase tracking-wide text-xs font-bold text-indigo-600">Phase 1: The Core Problem</div>
                    <h3 class="text-2xl font-bold text-stone-900">From Point Estimates to Posteriors</h3>
                    <p class="text-stone-600 leading-relaxed">
                        <strong>The Challenge:</strong> Current interpretability methods often label a component (e.g., "Induction Head") with absolute certainty, ignoring polysemanticity and noise.
                    </p>
                    <p class="text-stone-600 leading-relaxed">
                        <strong>The Approach:</strong> We propose treating circuit discovery as <em>Bayesian inference</em>. Instead of asking "Is this an X?", we compute the probability distribution over all potential functional hypotheses.
                    </p>
                    
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-indigo-500 mt-4">
                        <h4 class="font-semibold text-stone-900 text-sm">Interactive Demo</h4>
                        <p class="text-sm text-stone-500 mt-1 mb-3">Compare the traditional binary approach with the proposed Bayesian framework.</p>
                        <div class="flex gap-2">
                            <button onclick="updateUncertaintyChart('point')" class="flex-1 px-3 py-2 bg-white border border-stone-300 rounded text-xs font-medium text-stone-600 hover:border-indigo-500 hover:text-indigo-600 transition-colors focus:ring-2 focus:ring-indigo-200">
                                Current Approach
                            </button>
                            <button onclick="updateUncertaintyChart('bayesian')" class="flex-1 px-3 py-2 bg-indigo-600 border border-transparent rounded text-xs font-medium text-white hover:bg-indigo-700 transition-colors focus:ring-2 focus:ring-indigo-400">
                                Bayesian Proposal
                            </button>
                        </div>
                    </div>
                </div>

                <div class="md:w-1/2 w-full bg-stone-50 rounded-xl p-4 border border-stone-100 flex flex-col items-center justify-center">
                    <h4 id="chart1-title" class="text-sm font-semibold text-stone-700 mb-2 w-full text-center">Hypothesis Confidence</h4>
                    <div class="chart-container">
                        <canvas id="uncertaintyChart"></canvas>
                    </div>
                    <p id="chart1-desc" class="text-xs text-center text-stone-500 mt-3 italic">
                        Viewing probability distribution over functional roles.
                    </p>
                </div>
            </div>
        </section>

        <!-- Methodology Flow -->
        <section id="methodology">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-stone-900">The Inference Framework</h3>
                <p class="text-stone-600 mt-2 max-w-3xl">
                    How we operationalize Bayesian inference for mechanistic interpretability. This workflow shifts the focus from finding a single explanation to mapping the landscape of possibilities.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Step 1 -->
                <div class="bg-white p-6 rounded-xl card-shadow border border-stone-100 hover:border-indigo-200 transition-all">
                    <div class="w-10 h-10 bg-stone-100 rounded-full flex items-center justify-center text-stone-600 font-bold mb-4">1</div>
                    <h4 class="text-lg font-semibold text-stone-900 mb-2">Define Hypotheses</h4>
                    <p class="text-sm text-stone-600">
                        Formalize a set of functional candidates (e.g., Induction, Previous Token, Translation, Noise). These form the prior space.
                    </p>
                </div>

                <!-- Step 2 -->
                <div class="bg-white p-6 rounded-xl card-shadow border border-stone-100 hover:border-indigo-200 transition-all relative">
                    <!-- Arrow for desktop -->
                    <div class="hidden md:block absolute -left-4 top-1/2 transform -translate-y-1/2 text-stone-300">
                        &#10142;
                    </div>
                    <div class="w-10 h-10 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-600 font-bold mb-4">2</div>
                    <h4 class="text-lg font-semibold text-stone-900 mb-2">Observe Activations</h4>
                    <p class="text-sm text-stone-600">
                        Collect activation data across diverse inputs. Treat these as likelihood evidence to update our beliefs.
                    </p>
                </div>

                <!-- Step 3 -->
                <div class="bg-white p-6 rounded-xl card-shadow border border-stone-100 hover:border-indigo-200 transition-all relative">
                     <!-- Arrow for desktop -->
                     <div class="hidden md:block absolute -left-4 top-1/2 transform -translate-y-1/2 text-stone-300">
                        &#10142;
                    </div>
                    <div class="w-10 h-10 bg-teal-50 rounded-full flex items-center justify-center text-teal-600 font-bold mb-4">3</div>
                    <h4 class="text-lg font-semibold text-stone-900 mb-2">Compute Posterior</h4>
                    <p class="text-sm text-stone-600">
                        Generate a distribution: <br>
                        <code>P(Hypothesis | Data)</code>. <br>
                        Result: "60% Induction, 30% Copy, 10% Noise".
                    </p>
                </div>
            </div>
        </section>

        <!-- Phase 2: Validation Methodology -->
        <section id="phase2" class="bg-stone-900 text-stone-100 rounded-2xl p-8 card-shadow relative overflow-hidden">
            <!-- Background element -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-900 rounded-full filter blur-3xl opacity-20 -mr-16 -mt-16 pointer-events-none"></div>

            <div class="relative z-10">
                <div class="flex flex-col md:flex-row gap-10">
                    <div class="md:w-5/12 space-y-6">
                        <div class="uppercase tracking-wide text-xs font-bold text-teal-400">Phase 2: Validation Methodology</div>
                        <h3 class="text-2xl font-bold text-white">Posterior Predictive Checks</h3>
                        <p class="text-stone-300 leading-relaxed">
                            <strong>Question:</strong> How do we distinguish a real mechanism from a statistical fluke?
                        </p>
                        <p class="text-stone-300 leading-relaxed">
                            <strong>The Deliverable:</strong> A validation framework analogous to hierarchical modeling checks. We simulate data from our inferred "circuit" and compare it to the real model's behavior. If they don't match, the hypothesis is rejected, even if it was the "best fit".
                        </p>
                        
                        <div class="space-y-3 pt-4">
                            <h4 class="font-semibold text-white text-sm">Validation Simulator</h4>
                            <p class="text-xs text-stone-400">Select a scenario to visualize the predictive check:</p>
                            
                            <button onclick="updateValidationChart('noise')" class="w-full text-left px-4 py-3 bg-stone-800 rounded-lg border border-stone-700 hover:border-red-400 hover:bg-stone-750 transition-all flex items-center justify-between group">
                                <div>
                                    <span class="block text-sm font-bold text-red-200 group-hover:text-red-100">Scenario A: Coincidental Correlation</span>
                                    <span class="block text-xs text-stone-500 mt-1">High variance, poor predictive power.</span>
                                </div>
                                <div class="text-stone-500 group-hover:text-stone-300">&#10132;</div>
                            </button>

                            <button onclick="updateValidationChart('signal')" class="w-full text-left px-4 py-3 bg-stone-800 rounded-lg border border-stone-700 hover:border-teal-400 hover:bg-stone-750 transition-all flex items-center justify-between group">
                                <div>
                                    <span class="block text-sm font-bold text-teal-200 group-hover:text-teal-100">Scenario B: True Mechanism</span>
                                    <span class="block text-xs text-stone-500 mt-1">Tight clustering, strong predictive fit.</span>
                                </div>
                                <div class="text-stone-500 group-hover:text-stone-300">&#10132;</div>
                            </button>
                        </div>
                    </div>

                    <div class="md:w-7/12 bg-stone-800 rounded-xl p-4 border border-stone-700 flex flex-col">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-sm font-semibold text-stone-200">Predictive Check: Actual vs. Simulated</h4>
                            <span id="validation-status" class="text-xs px-2 py-1 rounded bg-stone-700 text-stone-300">Status: Idle</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="validationChart"></canvas>
                        </div>
                        <div class="mt-4 grid grid-cols-2 gap-4 text-xs text-stone-400">
                            <div class="bg-stone-900/50 p-2 rounded">
                                <span class="block text-stone-500 uppercase text-[10px]">X-Axis</span>
                                Predicted Activation (Hypothesis)
                            </div>
                            <div class="bg-stone-900/50 p-2 rounded">
                                <span class="block text-stone-500 uppercase text-[10px]">Y-Axis</span>
                                Observed Activation (Real Model)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Synthesis & Takeaways -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-teal-50 rounded-xl p-6 border border-teal-100">
                <h4 class="text-lg font-bold text-teal-900 mb-2">Phase 1 Deliverables</h4>
                <ul class="space-y-2 text-sm text-teal-800">
                    <li class="flex items-start">
                        <span class="mr-2 mt-1 text-teal-600">▪</span>
                        Formal definitions of functional hypotheses priors.
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 mt-1 text-teal-600">▪</span>
                        Computational pipeline for posterior calculation.
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 mt-1 text-teal-600">▪</span>
                        Shift from binary labeling to probability distributions.
                    </li>
                </ul>
            </div>
            <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100">
                <h4 class="text-lg font-bold text-indigo-900 mb-2">Phase 2 Deliverables</h4>
                <ul class="space-y-2 text-sm text-indigo-800">
                    <li class="flex items-start">
                        <span class="mr-2 mt-1 text-indigo-600">▪</span>
                        Suite of posterior predictive checks.
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 mt-1 text-indigo-600">▪</span>
                        Statistical tests for "Signal vs. Noise" distinction.
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 mt-1 text-indigo-600">▪</span>
                        Validated hierarchical models for circuit types.
                    </li>
                </ul>
            </div>
        </section>

    </main>

    <footer class="border-t border-stone-200 bg-white py-10 mt-12">
        <div class="max-w-5xl mx-auto px-4 text-center text-sm text-stone-400">
            <p>&copy; Research Proposal: Uncertainty in Circuit Identification.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA & STATE MANAGEMENT ---
        
        // Phase 1 Data: Comparison of Point Estimate vs Bayesian
        const uncertaintyData = {
            point: {
                labels: ['Induction Head', 'Previous Token', 'Duplicate Token', 'Noise'],
                data: [1.0, 0, 0, 0], // Absolute certainty (wrongly)
                backgroundColor: ['#4F46E5', '#E5E7EB', '#E5E7EB', '#E5E7EB'], // Highlight one
                title: "Traditional Point Estimate",
                desc: "Current methods often force a single label, ignoring ambiguity."
            },
            bayesian: {
                labels: ['Induction Head', 'Previous Token', 'Duplicate Token', 'Noise'],
                data: [0.55, 0.25, 0.15, 0.05], // Distributed belief
                backgroundColor: ['#4F46E5', '#6366F1', '#818CF8', '#94A3B8'], // Gradients of belief
                title: "Bayesian Posterior Distribution",
                desc: "Captures uncertainty. We are 55% sure it's an Induction Head, but alternatives remain plausible."
            }
        };

        // Phase 2 Data: Simulation of Validation
        // Generating random data for Scatter plots
        function generateScatterData(type) {
            const data = [];
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * 10;
                let y;
                if (type === 'signal') {
                    // Strong correlation with minor noise
                    y = x + (Math.random() - 0.5) * 1.5; 
                } else {
                    // Weak/No correlation (High noise)
                    y = (Math.random() * 10);
                }
                data.push({x: x, y: y});
            }
            return data;
        }

        // --- CHART INITIALIZATION ---

        // Chart 1: Uncertainty (Bar)
        let chart1Instance = null;
        function initUncertaintyChart() {
            const ctx = document.getElementById('uncertaintyChart').getContext('2d');
            
            // Initial State: Point Estimate
            const initialConfig = uncertaintyData.point;

            chart1Instance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: initialConfig.labels,
                    datasets: [{
                        label: 'Probability / Confidence',
                        data: initialConfig.data,
                        backgroundColor: initialConfig.backgroundColor,
                        borderRadius: 4,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Probability: ${(context.raw * 100).toFixed(0)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1.1,
                            title: { display: true, text: 'Probability P(H|D)' },
                            grid: { color: '#f3f4f6' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Chart 2: Validation (Scatter)
        let chart2Instance = null;
        function initValidationChart() {
            const ctx = document.getElementById('validationChart').getContext('2d');
            
            // Initial State: Empty or Signal
            const initialData = generateScatterData('signal');

            chart2Instance = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Validation Check',
                        data: initialData,
                        backgroundColor: '#2DD4BF', // Teal-400
                        borderColor: '#2DD4BF',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `(Pred: ${context.parsed.x.toFixed(1)}, Obs: ${context.parsed.y.toFixed(1)})`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { display: true, text: 'Model Prediction (Hypothesis)', color: '#9ca3af' },
                            grid: { color: '#374151' },
                            ticks: { color: '#9ca3af' }
                        },
                        y: {
                            title: { display: true, text: 'Actual Observation', color: '#9ca3af' },
                            grid: { color: '#374151' },
                            ticks: { color: '#9ca3af' }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
            
            // Set initial status text
            document.getElementById('validation-status').innerText = "Status: Valid Circuit (Baseline)";
            document.getElementById('validation-status').className = "text-xs px-2 py-1 rounded bg-teal-900 text-teal-300 border border-teal-700";
        }

        // --- INTERACTION HANDLERS ---

        // Update Phase 1 Chart
        window.updateUncertaintyChart = function(mode) {
            const config = uncertaintyData[mode];
            
            chart1Instance.data.datasets[0].data = config.data;
            chart1Instance.data.datasets[0].backgroundColor = config.backgroundColor;
            chart1Instance.update();

            // Update Text Context
            document.getElementById('chart1-title').innerText = config.title;
            document.getElementById('chart1-desc').innerText = config.desc;
        };

        // Update Phase 2 Chart
        window.updateValidationChart = function(type) {
            const newData = generateScatterData(type);
            const statusEl = document.getElementById('validation-status');

            // Update Chart
            chart2Instance.data.datasets[0].data = newData;
            
            if (type === 'signal') {
                chart2Instance.data.datasets[0].backgroundColor = '#2DD4BF'; // Teal
                statusEl.innerText = "PASS: Strong Correlation Detected";
                statusEl.className = "text-xs px-2 py-1 rounded bg-teal-900 text-teal-300 border border-teal-700";
            } else {
                chart2Instance.data.datasets[0].backgroundColor = '#F87171'; // Red
                statusEl.innerText = "FAIL: High Residuals / Noise";
                statusEl.className = "text-xs px-2 py-1 rounded bg-red-900 text-red-300 border border-red-700";
            }
            
            chart2Instance.update();
        };

        // Initialize on Load
        document.addEventListener('DOMContentLoaded', () => {
            initUncertaintyChart();
            initValidationChart();
        });

    </script>
</body>
</html>
